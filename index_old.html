<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <!-- <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar-nft.js"></script> -->
    <style>
      #infoDrawer {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        height: 0;
        overflow: auto;
        transition: height 0.5s ease;
      }
      #infoDrawer.open {
        height: 50%; /* Adjust height to control how much it covers */
      }
      #infoDrawer.full {
        height: 100%;
      }
      #infoContent {
        padding: 20px;
      }
      #toggleButton {
        display: block;
        padding: 10px;
        text-align: center;
        background: #f0f0f0;
        cursor: pointer;
      }
      .tabs-container {
        display: flex;
        background: #eee;
        padding: 5px;
      }
      .tab {
        padding: 10px;
        cursor: pointer;
      }
    </style>
  </head>

  <style>
    .arjs-loader {
      height: 100%;
      width: 100%;
      position: absolute;
      top: 0;
      left: 0;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .arjs-loader div {
      text-align: center;
      font-size: 1.25em;
      color: white;
    }
  </style>
  <body style="margin: 0; overflow: hidden">
    <!-- minimal loader shown until image descriptors are loaded. Loading may take a while according to the device computational power -->
    <div class="arjs-loader">
      <div>Loading, please wait...</div>
    </div>
    <a-scene vr-mode-ui="enabled: false;" renderer="logarithmicDepthBuffer: true;" embedded arjs="trackingMethod: best; sourceType: webcam;debugUIEnabled: true;">
      <a-nft type="nft" url="data/melek/melek" tag="melek" tag_id="melek01" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <a-nft type="nft" url="data/resurrection/the_resurrection" tag="resurrection" tag_id="resurrection01" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <a-nft type="nft" url="data/resurrection/the_resurrection2" tag="resurrection" tag_id="resurrection02" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <a-nft type="nft" url="data/resurrection/the_resurrection3" tag="resurrection" tag_id="resurrection03" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <a-nft type="nft" url="data/glass1/glass_1_1" tag="glass_1" tag_id="glass_1_1" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <a-nft type="nft" url="data/glass2/glass_2_3" tag="glass_2" tag_id="glass_2_3" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <a-nft type="nft" url="data/glass2/glass_2_2" tag="glass_2" tag_id="glass_2_2" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <a-nft type="nft" url="data/glass3/glass_3_2" tag="glass_3" tag_id="glass_3_2" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <a-nft type="nft" url="data/glass4/glass_4_2" tag="glass_4" tag_id="glass_4_2" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <a-nft type="nft" url="data/glass5/glass_5_1" tag="glass_5" tag_id="glass_5_1" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <a-nft type="nft" url="data/glass6/glass_6_1" tag="glass_6" tag_id="glass_6_1" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <a-nft type="nft" url="data/garden_of_death/garden_of_death" tag="garden_of_death" tag_id="garden_of_death01" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <a-nft type="nft" url="data/pipe_organ/pipe_organ" tag="pipe_organ" tag_id="pipe_organ01" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <!-- <a-nft type="nft" url="data/serpent/serpent" tag="serpent" tag_id="serpent_0" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <a-nft type="nft" url="data/serpent/serpent1" tag="serpent" tag_id="serpent_1" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <a-nft type="nft" url="data/serpent/serpent2" tag="serpent" tag_id="serpent_2" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft> -->
      <a-nft type="nft" url="data/serpent/serpent3" tag="serpent" tag_id="serpent_3" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <!-- <a-nft type="nft" url="data/serpent/serpent4" tag="serpent" tag_id="serpent_4" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <a-nft type="nft" url="data/serpent/serpent5" tag="serpent" tag_id="serpent_5" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft>
      <a-nft type="nft" url="data/serpent/serpent6" tag="serpent" tag_id="serpent_6" smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5"></a-nft> -->
      <a-marker preset="hiro" tag="garden_of_death"></a-marker>
      <a-marker preset="kanji"></a-marker>
      <a-entity camera></a-entity>
    </a-scene>

    <!-- <div id="infoDrawer">
      <div id="toggleButton">Tap here for more information</div>
      <div id="detectedMarkers">Markers: </div>
      <div id="infoContent">Information will be loaded here</div>
    </div> -->
    <!-- <div id="infoDrawer">
      <div id="tabs" class="tabs"></div>
      <div id="infoContent" class="content"></div>
    </div> -->
    <div id="infoDrawer">
      <div id="toggleButton">Tap here for more information</div>
      <div id="tabsContainer" class="tabs-container"></div>
      <div id="infoContent">Information will be loaded here</div>
    </div>
    
    <!-- <script>
      const markersState = {};
    
      function updateTabs() {
        const tabs = document.getElementById('tabs');
        const content = document.getElementById('infoContent');
        tabs.innerHTML = '';
        Object.keys(markersState).forEach((tag_id) => {
          const button = document.createElement('button');
          button.textContent = markersState[tag_id].tag;
          button.onclick = () => {
            content.innerHTML = markersState[tag_id].data;
          };
          tabs.appendChild(button);
        });
      }
    
      document.querySelectorAll("a-nft").forEach((marker) => {
        const tag_id = marker.getAttribute("tag_id");
    
        marker.addEventListener("markerFound", function () {
          const tag = marker.getAttribute("tag");
          if (!markersState[tag_id]) {
            markersState[tag_id] = { tag: tag, timer: null };
            fetch(`details/${tag}.html`)
              .then((response) => response.text())
              .then((data) => {
                markersState[tag_id].data = data;
                updateTabs();
              });
          }
          clearTimeout(markersState[tag_id].timer);
        });
    
        marker.addEventListener("markerLost", function () {
          markersState[tag_id].timer = setTimeout(() => {
            delete markersState[tag_id];
            updateTabs();
          }, 5000); // Remove tab after 5 seconds if marker is not found again
        });
      });
    </script> -->
    <!-- <script>
    document.addEventListener('DOMContentLoaded', function () {
  const markerData = {};

  document.querySelectorAll("a-nft").forEach((marker) => {
    marker.addEventListener("markerFound", function () {
      const tagId = marker.getAttribute("tag_id");
      markerData[tagId] = {
        lastDetected: Date.now(),
        element: marker
      };
      updateTabs();
      showContent(marker); // Immediately update content on detection
    });

    marker.addEventListener("markerLost", function () {
      const tagId = marker.getAttribute("tag_id");
      if (markerData[tagId]) {
        setTimeout(() => {
          if (Date.now() - markerData[tagId].lastDetected >= 2000) {
            delete markerData[tagId];
            updateTabs();
          }
        }, 2000);
      }
    });
  });

  const toggleButton = document.getElementById("toggleButton");
  toggleButton.addEventListener('click', function () {
    const drawer = document.getElementById("infoDrawer");
    if (drawer.classList.contains('open')) {
      drawer.classList.toggle('full');
    }
  });

  function updateTabs() {
    const tabsContainer = document.getElementById("tabsContainer");
    tabsContainer.innerHTML = ''; // Clear existing tabs

    Object.keys(markerData).forEach(tagId => {
      const tab = document.createElement('div');
      tab.className = 'tab';
      tab.textContent = tagId; // Use whatever title or identifier you prefer
      tab.onclick = () => showContent(markerData[tagId].element);
      tabsContainer.appendChild(tab);
    });

    if (Object.keys(markerData).length > 0) {
      document.getElementById("infoDrawer").classList.add("open");
    } else {
      document.getElementById("infoDrawer").classList.remove("open", "full");
    }
  }

  function showContent(marker) {
    const markerName = marker.getAttribute("tag");
    const content = document.getElementById("infoContent");
    fetch(`details/${markerName}.html`)
      .then(response => response.text())
      .then(data => {
        content.innerHTML = data;
      });
  }
});

    </script> -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
  const markersActive = {};
  const tagTimeouts = {};

  document.querySelectorAll("a-nft").forEach((marker) => {
    const tag = marker.getAttribute("tag");
    marker.addEventListener("markerFound", function () {
      if (!markersActive[tag]) {
        markersActive[tag] = {
          elements: [],
          lastDetected: Date.now()
        };
      }
      markersActive[tag].elements.push(marker);
      markersActive[tag].lastDetected = Date.now();

      updateTabs();
      showContent(tag); // Update content when new tag is detected
    });

    marker.addEventListener("markerLost", function () {
      setTimeout(() => {
        if (Date.now() - markersActive[tag].lastDetected >= 2000) {
          markersActive[tag].elements = markersActive[tag].elements.filter(m => m !== marker);
          if (markersActive[tag].elements.length === 0) {
            if (!document.getElementById("infoDrawer").classList.contains('full')) {
              delete markersActive[tag];
              updateTabs();
            } else {
              tagTimeouts[tag] = setTimeout(() => {
                delete markersActive[tag];
                updateTabs();
              }, 2000); // Additional timeout if drawer is in full state
            }
          }
        }
      }, 2000);
    });
  });

  const toggleButton = document.getElementById("toggleButton");
  toggleButton.addEventListener('click', function () {
    const drawer = document.getElementById("infoDrawer");
    if (drawer.classList.contains('open')) {
      drawer.classList.toggle('full');
    }
  });

  function updateTabs() {
    const tabsContainer = document.getElementById("tabsContainer");
    tabsContainer.innerHTML = ''; // Clear existing tabs

    Object.keys(markersActive).forEach(tag => {
      const tab = document.createElement('div');
      tab.className = 'tab';
      tab.textContent = tag; // Using tag as tab title
      tab.onclick = () => showContent(tag);
      tabsContainer.appendChild(tab);
    });

    if (Object.keys(markersActive).length > 0) {
      document.getElementById("infoDrawer").classList.add("open");
    } else {
      document.getElementById("infoDrawer").classList.remove("open", "full");
    }
  }

  function showContent(tag) {
    const content = document.getElementById("infoContent");
    fetch(`details/${tag}.html`)
      .then(response => response.text())
      .then(data => {
        content.innerHTML = data;
      });
  }
});

    </script>

    <!-- <script>
      let activeMarkers = {};
      document.querySelectorAll("a-marker, a-nft").forEach((marker) => {
        var markerName =
          marker.getAttribute("preset") || marker.getAttribute("tag");
        var markerTagId = marker.getAttribute("tag_id");

        var markerLost = false;
        marker.addEventListener("markerFound", function () {
          markerLost = false;
          var drawer = document.getElementById("infoDrawer");
          var detectedMarkers = document.getElementById("detectedMarkers");
          var content = document.getElementById("infoContent");
          activeMarkers[markerTagId] = true;
          fetch(`details/${markerName}.html`)
            .then((response) => response.text())
            .then((data) => {
              content.innerHTML = data;
              drawer.classList.add("open");
              // drawer.className = 'open';
            });
            // Add contents of active markers
          detectedMarkers.innerText = "Markers: " + Object.keys(activeMarkers).join(", ");
          content.innerHTML =
            "Information about " + marker.getAttribute("preset");
          drawer.className = "open";

          document.getElementById("toggleButton").onclick = function () {
            if (drawer.classList.contains("open")) {
              drawer.classList.add("full");
              drawer.classList.remove("open");
            } else if (drawer.classList.contains("full") && markerLost) {
              drawer.className = "";
            } else {
              drawer.classList.add("open");
              drawer.classList.remove("full");
            }
          };
        });

        marker.addEventListener("markerLost", function () {
          markerLost = true;
          var drawer = document.getElementById("infoDrawer");
          delete activeMarkers[markerTagId];
          if (drawer.classList.contains("open")) {
            drawer.className = "";
          }
        });
      });
    </script> -->
  </body>
</html>
